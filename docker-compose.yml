version: "3.9"

services:
  app:
    image: php:8.3-cli-alpine
    working_dir: /var/www/html
    volumes:
      - ./backend:/var/www/html
      - ./seed:/var/www/seed
      - ./bin:/var/www/bin
    command: >
      sh -c "apk add --no-cache git sqlite && \
             curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer && \
             composer install --ignore-platform-req=ext-intl && \
             php -S 0.0.0.0:8080 -t public"
    ports: [ "8080:8080" ]

  node:
    image: node:20-alpine
    working_dir: /app
    volumes:
      - ./frontend:/app
    command: sh -c "npm install && npm install -D tailwindcss@^3.4.0 postcss@^8.4.0 autoprefixer@^10.4.0 && npm run dev -- --host 0.0.0.0"
    ports: [ "5173:5173" ]

  db:
    image: mariadb:11
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: easycoach
    ports: [ "3306:3306" ]
